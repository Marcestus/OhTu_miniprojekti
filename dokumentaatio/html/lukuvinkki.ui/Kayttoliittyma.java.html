<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Kayttoliittyma.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lukuvinkki</a> &gt; <a href="index.source.html" class="el_package">lukuvinkki.ui</a> &gt; <span class="el_source">Kayttoliittyma.java</span></div><h1>Kayttoliittyma.java</h1><pre class="source lang-java linenums">package lukuvinkki.ui;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import lukuvinkki.dao.*;
import lukuvinkki.domain.*;

public class Kayttoliittyma {

    private IORajapinta io;
    private Lukuvinkkipalvelu palvelu;
    private TietokantaRajapinta tietokanta;

<span class="fc" id="L15">    public Kayttoliittyma(IORajapinta io, TietokantaRajapinta tietokanta) {</span>
<span class="fc" id="L16">        this.io = io;</span>
<span class="fc" id="L17">        this.tietokanta = tietokanta;</span>
<span class="fc" id="L18">        this.palvelu = new Lukuvinkkipalvelu(this.io, this.tietokanta);</span>
<span class="fc" id="L19">    }</span>

    public void kayttoliittymaStart() {
<span class="fc" id="L22">        io.print(&quot;Tervetuloa käyttämään lukuvinkkikirjastoa!&quot;);</span>
<span class="fc" id="L23">        tulostaKomennot();</span>
        loop:
        while (true) {
<span class="fc" id="L26">            io.print(&quot;Anna komento: &quot;);</span>
<span class="fc" id="L27">            String vastaus = io.syote();</span>
<span class="pc bpc" id="L28" title="4 of 8 branches missed.">            switch (vastaus) {</span>
                case &quot;1&quot;:
<span class="fc" id="L30">                    lisaaLukuvinkki();</span>
<span class="fc" id="L31">                    break;</span>
                case &quot;2&quot;:
<span class="fc" id="L33">                    poistaLukuvinkki();</span>
<span class="fc" id="L34">                    break;</span>
                case &quot;3&quot;:
<span class="fc" id="L36">                    haeLukuvunkit();</span>
<span class="fc" id="L37">                    break;</span>
                case &quot;4&quot;:
<span class="nc" id="L39">                    io.print(&quot;Tästä voi ohjelman tulevassa versiossa selailla tallennettuja lukuvinkkejä.&quot;);</span>
<span class="nc" id="L40">                    break;</span>
                case &quot;5&quot;:
<span class="nc" id="L42">                    io.print(&quot;Tästä voi ohjelman tulevassa versiossa muokata tallennettuja lukuvinkkejä.&quot;);</span>
<span class="nc" id="L43">                    break;</span>
                case &quot;6&quot;:
<span class="nc" id="L45">                    haeLukuvinkitTaginPerusteella();</span>
<span class="nc" id="L46">                    break;</span>
                case &quot;-1&quot;:
<span class="fc" id="L48">                    System.out.println(&quot;Ohjelma sulkeutuu...&quot;);</span>
<span class="fc" id="L49">                    break loop;</span>
                default:
<span class="nc" id="L51">                    io.print(&quot;Virheellinen komento.&quot;);</span>
                    break;
            }
<span class="fc" id="L54">        }</span>
<span class="fc" id="L55">    }</span>

    public void haeLukuvinkitTaginPerusteella() {
<span class="nc" id="L58">        io.print(&quot;Komento (hae lukuvinkit tägeillä) valittu \n&quot;);</span>
<span class="nc" id="L59">        io.print(&quot;Anna tägit haulle \n&quot;);</span>
<span class="nc" id="L60">        List&lt;String&gt; tagit = muodostaTagit(&quot;&quot;);</span>
<span class="nc" id="L61">        List&lt;Lukuvinkki&gt; vinkit = palvelu.haeLukuvinkitTaginPerusteella(tagit);</span>
<span class="nc" id="L62">        tulostaLukuvinkit(vinkit);</span>
<span class="nc" id="L63">    }</span>

    public void haeLukuvunkit() {
<span class="fc" id="L66">        io.print(&quot;Komento (hae lukuvinkit) valittu \n&quot;);</span>

<span class="fc" id="L68">        List&lt;Lukuvinkki&gt; vinkit = palvelu.haeLukuvunkit();</span>

<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (vinkit.isEmpty()) {</span>
<span class="nc" id="L71">            io.print(&quot;Tietokannassa ei lukuvinkkejä!&quot;);</span>
<span class="nc" id="L72">            return;</span>
        }

<span class="fc" id="L75">        io.print(&quot;Tietokannassa olevat lukuvinkit:&quot;);</span>
<span class="fc" id="L76">        tulostaLukuvinkit(vinkit);</span>
<span class="fc" id="L77">    }</span>

    public void tulostaLukuvinkit(List&lt;Lukuvinkki&gt; vinkit) {
<span class="fc bfc" id="L80" title="All 2 branches covered.">        for (Lukuvinkki lukuvinkki : vinkit) {</span>
<span class="fc" id="L81">            io.print(lukuvinkki.toString() + &quot;\n&quot;);</span>
<span class="fc" id="L82">        }</span>
<span class="fc" id="L83">    }</span>

    public ArrayList&lt;String&gt; muodostaTagit(String url) {
<span class="fc" id="L86">        ArrayList&lt;String&gt; tags = palvelu.lisaaTagitURLPerusteella(url);</span>

        while (true) {
<span class="fc" id="L89">            io.print(&quot;Anna uusi tagi: &quot;);</span>
<span class="fc" id="L90">            String tagit = io.syote();</span>

<span class="fc bfc" id="L92" title="All 2 branches covered.">            if (tagit.isEmpty()) {</span>
<span class="fc" id="L93">                break;</span>
<span class="pc bpc" id="L94" title="1 of 2 branches missed.">            } else if (tags.contains(tagit)) {</span>
<span class="nc" id="L95">                continue;</span>
            }

<span class="fc" id="L98">            tags.add(tagit);</span>
<span class="fc" id="L99">        }</span>

<span class="fc" id="L101">        return tags;</span>
    }

    private String muodostaOtsikko() {
        while (true) {
<span class="fc" id="L106">            String otsikko = io.syote();</span>

<span class="pc bpc" id="L108" title="1 of 2 branches missed.">            if (otsikko.length() &gt; 3) {</span>
<span class="fc" id="L109">                return otsikko;</span>
            } else {
<span class="nc" id="L111">                io.print(&quot;Virhe: Otsikon tulee olla vähintään 4 merkkiä pitkä&quot;);</span>
<span class="nc" id="L112">                io.print(&quot;Ole hyvä ja anna kelvollinen lukuvinkin otsikko: &quot;);</span>
            }
<span class="nc" id="L114">        }</span>
    }

    private String muodostaUrl() {
        while (true) {
<span class="fc" id="L119">            String url = palvelu.normalisoiUrl(io.syote());</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">            if (palvelu.sivustoOnOlemassa(url)) {</span>
<span class="fc" id="L121">                return url;</span>
            } else {
<span class="fc" id="L123">                io.print(&quot;Virhe: Osoitteella ei löytynyt sisältöä&quot;);</span>
<span class="fc" id="L124">                io.print(&quot;Ole hyvä ja anna kelvollinen lukuvinkin url: &quot;);</span>
            }
<span class="fc" id="L126">        }</span>
    }

    private String asetaValmisOtsikkoJosTarpeen(String aiemminSyotettyOtsikko, String syote, String url) {
<span class="fc bfc" id="L130" title="All 2 branches covered.">        if (syote.equals(&quot;k&quot;)) {</span>
<span class="fc" id="L131">            String haettuOtsikko = palvelu.getOtsikkoURLOsoitteesta(url);</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">            if (!haettuOtsikko.equals(&quot;epaonnistunut&quot;)) {</span>
<span class="fc" id="L133">                io.print(&quot;Otsikko '&quot; + haettuOtsikko + &quot;' haettu onnistuneesti!&quot;);</span>
<span class="fc" id="L134">                return haettuOtsikko;</span>
            } else {
<span class="nc" id="L136">                io.print(&quot;Valitettavasti sivuston otsikkoa ei voitu hakea.&quot;);</span>
<span class="nc" id="L137">                io.print(&quot;Käytämme aiemmin syöttämääsi otsikkoa.&quot;);</span>
            }
        }

<span class="fc" id="L141">        return aiemminSyotettyOtsikko;</span>
    }

    public void lisaaLukuvinkki() {
<span class="fc" id="L145">        io.print(&quot;Komento (lisää lukuvinkki) valittu \n&quot;);</span>

<span class="fc" id="L147">        io.print(&quot;Anna lukuvinkin otsikko: &quot;);</span>
<span class="fc" id="L148">        String otsikko = muodostaOtsikko();</span>

<span class="fc" id="L150">        io.print(&quot;Anna lukuvinkin url: &quot;);</span>
<span class="fc" id="L151">        String url = muodostaUrl();</span>

<span class="fc" id="L153">        io.print(&quot;Haluatko korvata aiemmin syötetyn otsikon hakemalla sivuston otsikon?\n&quot;</span>
                + &quot;(Syötä 'k' mikäli kyllä, muuten paina Enter)&quot;);
<span class="fc" id="L155">        String valmisOtsikkoKomento = io.syote();</span>
<span class="fc" id="L156">        otsikko = asetaValmisOtsikkoJosTarpeen(otsikko, valmisOtsikkoKomento, url);</span>

<span class="fc" id="L158">        io.print(&quot;Anna tagit lukuvinkille: &quot;);</span>
<span class="fc" id="L159">        io.print(&quot;(paina Enter, jos et tahdo lisätä omia tagejä.)&quot;);</span>
<span class="fc" id="L160">        List&lt;String&gt; tagit = muodostaTagit(url);</span>

<span class="pc bpc" id="L162" title="1 of 2 branches missed.">        if (palvelu.lisaaLukuvinkki(otsikko, url, tagit)) {</span>
<span class="fc" id="L163">            Lukuvinkki lukuvinkki = new Lukuvinkki(otsikko, url, &quot;&quot;);</span>
<span class="fc" id="L164">            lukuvinkki.setTagit(tagit);</span>
<span class="fc" id="L165">            io.print(&quot;Uusi lukuvinkki:\n&quot; + lukuvinkki.toString() + &quot;\nlisätty onnistuneesti tietokantaan!&quot;);</span>
<span class="fc" id="L166">        } else {</span>
<span class="nc" id="L167">            io.print(&quot;Virheelliset arvot lukuvinkissä, muutoksia ei tehty.&quot;);</span>
        }
<span class="fc" id="L169">    }</span>

    public void poistaLukuvinkki() {
<span class="fc" id="L172">        io.print(&quot;Komento (poista lukuvinkki) valittu \n&quot;);</span>

<span class="fc" id="L174">        io.print(&quot;Syötä u, jos haluat poistaa lukuvinkin url:n perusteella\n&quot;</span>
                + &quot;Syötä o, jos haluat poistaa lukuvinkin otsikon perusteella&quot;);

<span class="fc" id="L177">        String poistettava = io.syote();</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">        if (poistettava.equals(&quot;u&quot;)) {</span>
<span class="fc" id="L179">            urlPoistoKyselyt();</span>
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">        } else if (poistettava.equals(&quot;o&quot;)) {</span>
<span class="fc" id="L181">            otsikkoPoistoKyselyt();</span>
        } else {
<span class="nc" id="L183">            io.print(&quot;Virheellinen syöte!&quot;);</span>
        }
<span class="fc" id="L185">    }</span>

    public void urlPoistoKyselyt() {
<span class="fc" id="L188">        io.print(&quot;Syötä poistettavan lukuvinkin url:&quot;);</span>
<span class="fc" id="L189">        String url = io.syote();</span>
<span class="fc" id="L190">        Lukuvinkki poistettavaLukuvinkki = palvelu.haeLukuvinkkiUrlPerusteella(url);</span>
        
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (poistettavaLukuvinkki.getID() != -1) {</span>
<span class="fc" id="L193">            io.print(&quot;\n&quot; + poistettavaLukuvinkki.toString() + &quot;\n&quot;);</span>
<span class="fc" id="L194">            io.print(&quot;Poistetaanko lukuvinkki? \n kyllä: syötä k\n ei: paina enter&quot;);</span>
<span class="fc" id="L195">            String poisto = io.syote();</span>
            
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">            if (poisto.equals(&quot;k&quot;)) {</span>
<span class="pc bpc" id="L198" title="1 of 2 branches missed.">                if (palvelu.poistaLukuvinkki(poistettavaLukuvinkki.getID())) {</span>
<span class="fc" id="L199">                    io.print(&quot;Lukuvinkin poistaminen onnistui&quot;);</span>
                } else {
<span class="nc" id="L201">                    io.print(&quot;Poistaminen ei onnistunut&quot;);</span>
                }
            } else {
<span class="nc" id="L204">                io.print(&quot;Lukuvinkkiä ei poisteta.&quot;);</span>
            }
<span class="fc" id="L206">        } else {</span>
<span class="nc" id="L207">            io.print(&quot;Syöttämääsi url-osoitetta ei ole tietokannassa.&quot;);</span>
        }
<span class="fc" id="L209">    }</span>

    public void otsikkoPoistoKyselyt() {
<span class="fc" id="L212">        io.print(&quot;Syötä poistettavan lukuvinkin otsikko:&quot;);</span>
<span class="fc" id="L213">        String otsikko = io.syote();</span>
<span class="fc" id="L214">        Lukuvinkki poistettavaLukuvinkki = palvelu.haeLukuvinkkiOtsikonPerusteella(otsikko);</span>
        
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">        if (poistettavaLukuvinkki.getID() != -1) {</span>
<span class="fc" id="L217">            io.print(&quot;\n&quot; + poistettavaLukuvinkki.toString() + &quot;\n&quot;);</span>
<span class="fc" id="L218">            io.print(&quot;Poistetaanko lukuvinkki? \n kyllä: syötä k\n ei: paina enter&quot;);</span>
<span class="fc" id="L219">            String poisto = io.syote();</span>
            
<span class="fc bfc" id="L221" title="All 2 branches covered.">            if (poisto.equals(&quot;k&quot;)) {</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">                if (palvelu.poistaLukuvinkki(poistettavaLukuvinkki.getID())) {</span>
<span class="fc" id="L223">                    io.print(&quot;Lukuvinkin poistaminen onnistui&quot;);</span>
                } else {
<span class="nc" id="L225">                    io.print(&quot;Poistaminen ei onnistunut&quot;);</span>
                }
            } else {
<span class="fc" id="L228">                io.print(&quot;Lukuvinkkiä ei poistettu.\n&quot;);</span>
            }
<span class="fc" id="L230">        } else {</span>
<span class="nc" id="L231">            io.print(&quot;Syöttämääsi otsikkoa ei ole tietokannassa.&quot;);</span>
        }
<span class="fc" id="L233">    }</span>

    public void tulostaKomennot() {
<span class="fc" id="L236">        io.print(&quot;Komennot:&quot;);</span>
<span class="fc" id="L237">        io.print(&quot;1 - lisää lukuvinkki&quot;);</span>
<span class="fc" id="L238">        io.print(&quot;2 - poista lukuvinkki&quot;);</span>
<span class="fc" id="L239">        io.print(&quot;3 - hae lukuvinkit&quot;);</span>
<span class="fc" id="L240">        io.print(&quot;4 - selaa lukuvinkkejä&quot;);</span>
<span class="fc" id="L241">        io.print(&quot;5 - muokkaa lukuvinkkejä&quot;);</span>
<span class="fc" id="L242">        io.print(&quot;6 - hae lukuvinkit tägeillä&quot;);</span>
<span class="fc" id="L243">        io.print(&quot;-1 - lopeta ohjelma&quot;);</span>
<span class="fc" id="L244">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>